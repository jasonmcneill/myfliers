services:
  # Service 1: The API Server
  # api:
  #   build: .
  #   ports:
  #     - "3000:3000"
  #   volumes:
  #     # THE MAGIC: Syncs your local folder to the container folder
  #     - ./:/app
  #     # Prevent local node_modules from overriding container node_modules
  #     - /app/node_modules
  #   environment:
  #     - NODE_ENV=development
  #     # Add your env vars here later
  #   command: npm run dev

  # Service 2: The Test Runner
  tests:
    build: .
    volumes:
      - ./:/app
      - /app/node_modules
    profiles: ["test"]
    command: sh -c "npm install && npm run test"
